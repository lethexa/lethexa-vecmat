/*! lethexa-vecmat 2016-12-18 Copyright by Tim Leerhoff <tleerhof@web.de> */
!function(c){"use strict";var d=2*Math.PI,e=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},f=function(a){for(;a>=d;)a-=d;for(;0>a;)a+=d;return a},g=function(a){for(;a<-Math.PI;)a+=d;for(;a>=Math.PI;)a-=d;return a};c.MathFunc3d={makeVector:function(a){return new c.Vector3d(a[0],a[1],a[2])},nullVector:function(){return new c.Vector3d(0,0,0)},add:function(a,b){return a.add(b)},sub:function(a,b){return a.sub(b)},mulScalar:function(a,b){return a.mulScalar(b)},dot:function(a,b){return a.dot(b)},cross:function(a,b){return a.cross(b)},unit:function(a){return a.unit()},toArray:function(a){return a.toArray()},lengthSquared:function(a){return a.lengthSquared()}},c.intersectionAtPositiveYAxis2d=function(a,b){if(!(a._y<0&&b._y<0||a._x<0&&b._x<0||a._x>0&&b._x>0)){var d,e=b._y-a._y,f=b._x-a._x;if(0===f){if(d=b._y<a._y?b._y:a._y,0>d)return;return c.vector3dFromElements(0,d,0)}if(d=a._y+e/f*(0-a._x),!(0>d))return c.vector3dFromElements(0,d,0)}},c.vector2dFromString=function(a){var b=a.split(";");if(b.length<2)throw new Error("Too few arguments");return new c.Vector2d(parseFloat(b[0]),parseFloat(b[1]))},c.vector2dFromPolar=function(a,b){return new c.Vector2d(b*Math.cos(a),b*Math.sin(a))},c.vector2dFromArray=function(a){return new c.Vector2d(a[0],a[1])},c.vector2dFromElements=function(a,b){return new c.Vector2d(a,b)},c.Vector2d=function(a,b){this._x=a,this._y=b},c.Vector2d.prototype.round=function(a){return new c.Vector2d(e(this._x,a),e(this._y,a))},c.Vector2d.prototype.isEqualTo=function(a){return this._x!==a._x?!1:this._y===a._y},c.Vector2d.prototype.x=function(){return this._x},c.Vector2d.prototype.y=function(){return this._y},c.Vector2d.prototype.length=function(){return Math.sqrt(this.lengthSquared())},c.Vector2d.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y},c.Vector2d.prototype.distanceTo=function(a){return a.sub(this).length()},c.Vector2d.prototype.unit=function(){var a=this.length();if(0!==a)return new c.Vector2d(this._x/a,this._y/a)},c.Vector2d.prototype.neg=function(){return new c.Vector2d(-this._x,-this._y)},c.Vector2d.prototype.pitch=function(){var a=Math.atan2(this._y,this._x);return a},c.Vector2d.prototype.add=function(a){return new c.Vector2d(this._x+a._x,this._y+a._y)},c.Vector2d.prototype.sub=function(a){return new c.Vector2d(this._x-a._x,this._y-a._y)},c.Vector2d.prototype.mul=function(a){return this.mulScalar(a)},c.Vector2d.prototype.mulScalar=function(a){return new c.Vector2d(this._x*a,this._y*a)},c.Vector2d.prototype.dot=function(a){return this._x*a._x+this._y*a._y},c.Vector2d.prototype.toArray=function(){return[this._x,this._y]},c.Vector2d.prototype.toString=function(){return""+this._x+";"+this._y};var h=Object.freeze(new c.Vector2d(1,0)),i=Object.freeze(new c.Vector2d(0,1)),j=Object.freeze(new c.Vector2d(0,0));c.makeUnitXVector2d=function(){return h},c.makeUnitYVector2d=function(){return i},c.makeNullVector2d=function(){return j},c.vector3dFromString=function(a){var b=a.split(";");if(b.length<3)throw new Error("Too few arguments");return new c.Vector3d(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]))},c.vector3dFromPolar=function(a,b,d){var e=d*Math.cos(a),f=-d*Math.sin(a);return new c.Vector3d(e*Math.cos(b),e*Math.sin(b),f)},c.vector3dFromArray=function(a){return new c.Vector3d(a[0],a[1],a[2])},c.vector3dFromElements=function(a,b,d){return new c.Vector3d(a,b,d)},c.Vector3d=function(a,b,c){this._x=a,this._y=b,this._z=c},c.Vector3d.prototype.round=function(a){return new c.Vector3d(e(this._x,a),e(this._y,a),e(this._z,a))},c.Vector3d.prototype.isEqualTo=function(a){return this._x!==a._x?!1:this._y!==a._y?!1:this._z===a._z},c.Vector3d.prototype.x=function(){return this._x},c.Vector3d.prototype.y=function(){return this._y},c.Vector3d.prototype.z=function(){return this._z},c.Vector3d.prototype.length=function(){return Math.sqrt(this.lengthSquared())},c.Vector3d.prototype.distanceTo=function(a){return a.sub(this).length()},c.Vector3d.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},c.Vector3d.prototype.unit=function(){var a=this.length();if(0!==a)return new c.Vector3d(this._x/a,this._y/a,this._z/a)},c.Vector3d.prototype.neg=function(){return new c.Vector3d(-this._x,-this._y,-this._z)},c.Vector3d.prototype.pitch=function(){var a=Math.sqrt(this._x*this._x+this._y*this._y),b=-Math.atan2(this._z,a);return b},c.Vector3d.prototype.yaw=function(){var a=Math.atan2(this._y,this._x);return a},c.Vector3d.prototype.add=function(a){return new c.Vector3d(this._x+a._x,this._y+a._y,this._z+a._z)},c.Vector3d.prototype.sub=function(a){return new c.Vector3d(this._x-a._x,this._y-a._y,this._z-a._z)},c.Vector3d.prototype.mul=function(a){return this.mulScalar(a)},c.Vector3d.prototype.mulScalar=function(a){return new c.Vector3d(this._x*a,this._y*a,this._z*a)},c.Vector3d.prototype.dot=function(a){return this._x*a._x+this._y*a._y+this._z*a._z},c.Vector3d.prototype.cross=function(a){var b=this._y*a._z-this._z*a._y,d=this._z*a._x-this._x*a._z,e=this._x*a._y-this._y*a._x;return new c.Vector3d(b,d,e)},c.Vector3d.prototype.spat=function(a,b){return this.dot(a.cross(b))},c.Vector3d.prototype.toArray=function(){return[this._x,this._y,this._z]},c.Vector3d.prototype.toString=function(){return""+this._x+";"+this._y+";"+this._z};var k=Object.freeze(new c.Vector3d(1,0,0)),l=Object.freeze(new c.Vector3d(0,1,0)),m=Object.freeze(new c.Vector3d(0,0,1)),n=Object.freeze(new c.Vector3d(0,0,0));c.makeUnitXVector3d=function(){return k},c.makeUnitYVector3d=function(){return l},c.makeUnitZVector3d=function(){return m},c.makeNullVector3d=function(){return n},c.matrix3x3FromArray=function(a){return new c.Matrix3x3(a)},c.makeUnitMatrix3x3=function(){return new c.Matrix3x3([[1,0,0],[0,1,0],[0,0,1]])},c.makeNullMatrix3x3=function(){return new c.Matrix3x3([[0,0,0],[0,0,0],[0,0,0]])},c.toGlobalMatrix3x3=function(a,b,d){var e=c.makeUnitMatrix3x3();return 0!==a&&(e=c.makeXRotation3x3(a).mul(e)),0!==b&&(e=c.makeYRotation3x3(b).mul(e)),0!==d&&(e=c.makeZRotation3x3(d).mul(e)),e},c.toLocalMatrix3x3=function(a,b,d){var e=c.makeUnitMatrix3x3();return 0!==d&&(e=c.makeZRotation3x3(d).mul(e)),0!==b&&(e=c.makeYRotation3x3(b).mul(e)),0!==a&&(e=c.makeXRotation3x3(a).mul(e)),e},c.makeXRotation3x3=function(a){var b=Math.sin(a),d=Math.cos(a);return new c.Matrix3x3([[1,0,0],[0,d,-b],[0,b,d]])},c.makeYRotation3x3=function(a){var b=Math.sin(a),d=Math.cos(a);return new c.Matrix3x3([[d,0,b],[0,1,0],[-b,0,d]])},c.makeZRotation3x3=function(a){var b=Math.sin(a),d=Math.cos(a);return new c.Matrix3x3([[d,-b,0],[b,d,0],[0,0,1]])},c.makeScale3x3=function(a,b,d){return new c.Matrix3x3([[a,0,0],[0,b,0],[0,0,d]])},c.Matrix3x3=function(a){if(a.length<3)throw new Error("vertical array to short");this._elements=a,this.e11=this._elements[0][0],this.e12=this._elements[0][1],this.e13=this._elements[0][2],this.e21=this._elements[1][0],this.e22=this._elements[1][1],this.e23=this._elements[1][2],this.e31=this._elements[2][0],this.e32=this._elements[2][1],this.e33=this._elements[2][2]},c.Matrix3x3.prototype.round=function(a){return new c.Matrix3x3([[e(this.e11,a),e(this.e12,a),e(this.e13,a)],[e(this.e21,a),e(this.e22,a),e(this.e23,a)],[e(this.e31,a),e(this.e32,a),e(this.e33,a)]])},c.Matrix3x3.prototype.isEqualTo=function(a){var b,c;for(c=0;c<this._elements.length;c++)for(b=0;b<this._elements[c].length;b++)if(this._elements[c][b]!==a._elements[c][b])return!1;return!0},c.Matrix3x3.prototype.mulScalar=function(a){return new c.Matrix3x3([[this.e11*a,this.e12*a,this.e13*a],[this.e21*a,this.e22*a,this.e23*a],[this.e31*a,this.e32*a,this.e33*a]])},c.Matrix3x3.prototype.mulVector=function(a){if(!(a instanceof c.Vector3d))throw new Error("u is not a Vector3d");return new c.Vector3d(this.e11*a.x()+this.e12*a.y()+this.e13*a.z(),this.e21*a.x()+this.e22*a.y()+this.e23*a.z(),this.e31*a.x()+this.e32*a.y()+this.e33*a.z())},c.Matrix3x3.prototype.mul=function(a){if(!(a instanceof c.Matrix3x3))throw new Error("m is not a Matrix3x3");return new c.Matrix3x3([[this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,this.e11*a.e13+this.e12*a.e23+this.e13*a.e33],[this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,this.e21*a.e13+this.e22*a.e23+this.e23*a.e33],[this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,this.e31*a.e13+this.e32*a.e23+this.e33*a.e33]])},c.Matrix3x3.prototype.add=function(a){return new c.Matrix3x3([[this.e11+a.e11,this.e12+a.e12,this.e13+a.e13],[this.e21+a.e21,this.e22+a.e22,this.e23+a.e23],[this.e31+a.e31,this.e32+a.e32,this.e33+a.e33]])},c.Matrix3x3.prototype.sub=function(a){return new c.Matrix3x3([[this.e11-a.e11,this.e12-a.e12,this.e13-a.e13],[this.e21-a.e21,this.e22-a.e22,this.e23-a.e23],[this.e31-a.e31,this.e32-a.e32,this.e33-a.e33]])},c.Matrix3x3.prototype.transpose=function(){return new c.Matrix3x3([[this.e11,this.e21,this.e31],[this.e12,this.e22,this.e32],[this.e13,this.e23,this.e33]])},c.Matrix3x3.prototype.det=function(){return this.e11*this.e22*this.e33+this.e12*this.e23*this.e31+this.e13*this.e21*this.e32-this.e13*this.e22*this.e31-this.e11*this.e23*this.e32-this.e12*this.e21*this.e33},c.Matrix3x3.prototype.inverse=function(){var a=this.det();return 0===a&&(a=1),c.matrix3x3FromArray([[(this.e22*this.e23-this.e23*this.e32)/a,-(this.e12*this.e33-this.e13*this.e32)/a,(this.e12*this.e23-this.e13*this.e22)/a],[-(this.e21*this.e33-this.e23*this.e31)/a,(this.e11*this.e33-this.e13*this.e31)/a,-(this.e11*this.e23-this.e13*this.e21)/a],[(this.e21*this.e32-this.e22*this.e31)/a,-(this.e11*this.e32-this.e12*this.e31)/a,(this.e11*this.e22-this.e12*this.e21)/a]])},c.Matrix3x3.prototype.phi=function(){return Math.atan2(this.e32,this.e33)},c.Matrix3x3.prototype.theta=function(){return Math.asin(-this.e31)},c.Matrix3x3.prototype.psi=function(){return Math.atan2(this.e21,this.e11)},c.Matrix3x3.prototype.toArray=function(){return[[this.e11,this.e12,this.e13],[this.e21,this.e22,this.e23],[this.e31,this.e32,this.e33]]},c.Matrix3x3.prototype.toString=function(){var a="";return this._elements.forEach(function(b){b.forEach(function(b){a+=""+b+","}),a+="\n"}),a},c.shortestArcQuat=function(a,b){a=a.unit(),b=b.unit();var d=a.cross(b),e=a.dot(b);if(-1===e)return c.quatFromRotation(Math.PI,c.makeNullVector3d());if(1===e)return c.quatFromRotation(0,c.makeUnitZVector3d());var f=Math.sqrt(2*(1+e));return new c.Quat(f/2,new c.Vector3d(d.x()/f,d.y()/f,d.z()/f))},c.quatFromEulerAngles=function(a,b,d){var e=Math.cos(.5*a),f=Math.cos(.5*b),g=Math.cos(.5*d),h=Math.sin(.5*a),i=Math.sin(.5*b),j=Math.sin(.5*d),k=g*f,l=j*i,m=g*i,n=j*f;return new c.Quat(k*e+l*h,new c.Vector3d(k*h-l*e,m*e+n*h,n*e-m*h))},c.quatFromRotation=function(a,b){var d=.5*a;return new c.Quat(Math.cos(d),b.mul(Math.sin(d)))},c.quatFromVector3d=function(a){return new c.Quat(0,a)},c.Quat=function(a,b){if(void 0===a)throw new Error("r is undefined");if(void 0===b)throw new Error("v is undefined");this._r=a,this._v=b},c.Quat.prototype.round=function(a){return new c.Quat(e(this._r,a),this._v.round(a))},c.Quat.prototype.isEqualTo=function(a){return this._r!==a._r?!1:!!this._v.isEqualTo(a._v)},c.Quat.prototype.real=function(){return this._r},c.Quat.prototype.imag=function(){return this._v},c.Quat.prototype.add=function(a){return new c.Quat(this._r+a._r,this._v.add(a._v))},c.Quat.prototype.sub=function(a){return new c.Quat(this._r-a._r,this._v.sub(a._v))},c.Quat.prototype.lengthSquared=function(){var a=this._v.lengthSquared();return this._r*this._r+a},c.Quat.prototype.length=function(){return Math.sqrt(this.lengthSquared())},c.Quat.prototype.unit=function(){var a=this.length();if(0===a)throw new Error("unit not possible because length is 0");var b=1/a;return new c.Quat(this._r*b,this._v.mul(b))},c.Quat.prototype.dot=function(a){return a._r*this._r+a._v.x()*this._v.x()+a._v.y()*this._v.y()+a._v.z()*this._v.z()},c.Quat.prototype.axis=function(){var a=this.length();return 0===a?new c.Vector3d(0,0,0):this._v.mul(a)},c.Quat.prototype.angle=function(){return 2*Math.acos(this._r)},c.Quat.prototype.angleTo=function(a){return 2*Math.acos(this.dot(a))},c.Quat.prototype.lerpTo=function(a,b){var c=this;return c.mulScalar(1-b).add(a.mulScalar(b))},c.Quat.prototype.slerpTo=function(a,b){var c=this,d=a,e=c.dot(d);0>e?(d=-d,e=c.dot(d)):e>1&&(e=1);var f=Math.acos(e);if(0===f)return c;var g=Math.sin(f),h=Math.sin((1-b)*f)/g,i=Math.sin(b*f)/g;return c.mulScalar(h).add(d.mulScalar(i))},c.Quat.prototype.neg=function(){return new c.Quat(-this._r,this._v.neg())},c.Quat.prototype.conj=function(){return new c.Quat(this._r,this._v.neg())},c.Quat.prototype.pow=function(a){return new c.Quat(a*this.angle(),this.axis())},c.Quat.prototype.mulScalar=function(a){return new c.Quat(this._r*a,this._v.mulScalar(a))},c.Quat.prototype.toEulerAngles=function(a){var b=this._r,c=this._v.x(),d=this._v.y(),e=this._v.z();return[f(Math.atan2(d*e+b*c,.5-(c*c+d*d))),Math.asin(-2*(c*e+b*d)),f(Math.atan2(c*d+b*e,.5-(d*d+e*e)))]},c.Quat.prototype.rotateVector=function(a){return this.mul(c.quatFromVector3d(a)).mul(this.conj()).imag()},c.Quat.prototype.mul=function(a){var b=this._r,d=this._v.x(),e=this._v.y(),f=this._v.z(),g=a._r,h=a._v.x(),i=a._v.y(),j=a._v.z();return new c.Quat(b*g-d*h-e*i-f*j,new c.Vector3d(b*h+d*g+e*j-f*i,b*i+e*g+f*h-d*j,b*j+f*g+d*i-e*h))},c.Quat.prototype.mulVector=function(a){var b=new c.Quat(0,a);return this.mul(b).mul(this.conj())},c.Quat.prototype.toMatrix3x3=function(){var a=this._r,b=this._v.x(),d=this._v.y(),e=this._v.z(),f=b*b,g=d*d,h=e*e,i=b*d,j=b*e,k=d*e,l=a*b,m=a*d,n=a*e;return new c.Matrix3x3([[1-2*(g+h),2*(i-n),2*(m+j)],[2*(i+n),1-2*(f+h),2*(k-l)],[2*(j-m),2*(k+l),1-2*(f+g)]])},c.Quat.prototype.toString=function(){return this._r+","+this._v},c.rayFromPoints=function(a,b){return new c.Ray(a,b.sub(a))},c.rayFromPointDir=function(a,b){return new c.Ray(a,b)},c.Ray=function(a,b){this._start=a,this._direction=b.unit()},c.Ray.prototype.isEqualTo=function(a){return this._start.isEqualTo(a._start)?!!this._direction.isEqualTo(a._direction):!1},c.Ray.prototype.getStart=function(){return this._start},c.Ray.prototype.getDirection=function(){return this._direction},c.Ray.prototype.getPointAtLength=function(a){return this._start.add(this._direction.mulScalar(a))};var o=1e-6;c.Triangle=function(a,b,c){this._v1=a,this._v2=b,this._v3=c,this._e1=b.sub(a),this._e2=c.sub(a),this._normal=this._e1.cross(this._e2).unit()},c.Triangle.prototype.isEqualTo=function(a){return this._v1.isEqualTo(a._v1)&&this._v2.isEqualTo(a._v2)?!!this._v3.isEqualTo(a._v3):!1},c.Triangle.prototype.getNormal=function(){return this._n},c.Triangle.prototype.intersect=function(a){var b,c,d,e,f,g,h,i,j=a.getStart(),k=a.getDirection();return b=k.cross(this._e2),e=this._e1.dot(b),e>-o&&o>e||(f=1/e,d=j.sub(this._v1),g=d.dot(b)*f,0>g||g>1||(c=d.cross(this._e1),h=k.dot(c)*f,0>h||g+h>1||(i=this._e2.dot(c)*f,o>=i)))?void 0:{object:this,normal:this._normal,ray:a,pointOfIntersect:a.getPointAtLength(i),rayLengthOfIntersect:i}},c.Triangle.prototype.toString=function(){return"pt1="+this._v1+", pt2="+this._v2+", pt3="+this._v3},c.Plane=function(a,b){this._v=a,this._n=b},c.Plane.prototype.isEqualTo=function(a){return this._v.isEqualTo(a._v)?!!this._n.isEqualTo(a._n):!1},c.Plane.prototype.intersect=function(a){var b=this._v,c=this._n,d=a.getStart(),e=a.getDirection(),f=b.sub(d).dot(c),g=e.dot(c);if(0!==g){var h=f/g;if(!(0>=h))return{object:this,normal:this._n,ray:a,pointOfIntersect:a.getPointAtLength(h),rayLengthOfIntersect:h}}},c.Plane.prototype.toString=function(){return"p="+this._v+", n="+this._n},c.box3dFromElements=function(a,b,d,e,f,g){var h=c.vector3dFromElements(a,b,d),i=c.vector3dFromElements(e,f,g);return c.Box3d(h,i)},c.Box3d=function(a,b){this._pt1=a,this._pt2=b},c.Box3d.prototype.isEqualTo=function(a){return this._pt1.isEqualTo(a._pt1)?!!this._pt2.isEqualTo(a._pt2):!1},c.Box3d.prototype.containsPoint=function(a){return a.x()<this._pt1.x()||a.x()>this._pt2.x()?!1:a.y()<this._pt1.y()||a.y()>this._pt2.y()?!1:!(a.z()<this._pt1.z()||a.z()>this._pt2.z())},c.Box3d.prototype.intersects=function(a){var b=a._pt1,d=c.vector2dFromElements(a._pt1.x(),a._pt1.y(),a._pt2.z()),e=c.vector2dFromElements(a._pt1.x(),a._pt2.y(),a._pt1.z()),f=c.vector2dFromElements(a._pt1.x(),a._pt2.y(),a._pt2.z()),g=c.vector2dFromElements(a._pt2.x(),a._pt1.y(),a._pt1.z()),h=c.vector2dFromElements(a._pt2.x(),a._pt1.y(),a._pt2.z()),i=c.vector2dFromElements(a._pt2.x(),a._pt2.y(),a._pt1.z()),j=a._pt2;if(this.containsPoint(b))return!0;if(this.containsPoint(d))return!0;if(this.containsPoint(e))return!0;if(this.containsPoint(f))return!0;if(this.containsPoint(g))return!0;if(this.containsPoint(h))return!0;if(this.containsPoint(i))return!0;if(this.containsPoint(j))return!0;var k=this._pt1,l=c.vector2dFromElements(this._pt1.x(),this._pt1.y(),this._pt2.z()),m=c.vector2dFromElements(this._pt1.x(),this._pt2.y(),this._pt1.z()),n=c.vector2dFromElements(this._pt1.x(),this._pt2.y(),this._pt2.z()),o=c.vector2dFromElements(this._pt2.x(),this._pt1.y(),this._pt1.z()),p=c.vector2dFromElements(this._pt2.x(),this._pt1.y(),this._pt2.z()),q=c.vector2dFromElements(this._pt2.x(),this._pt2.y(),this._pt1.z()),r=this._pt2;return a.containsPoint(k)?!0:a.containsPoint(l)?!0:a.containsPoint(m)?!0:a.containsPoint(n)?!0:a.containsPoint(o)?!0:a.containsPoint(p)?!0:a.containsPoint(q)?!0:!!a.containsPoint(r)},c.Box3d.prototype.toString=function(){return"p1="+this._pt1+", pt2="+this._pt2},c.box2dFromElements=function(a,b,d,e){var f=c.vector2dFromElements(a,b),g=c.vector2dFromElements(d,e);return c.Box2d(f,g)},c.Box2d=function(a,b){this._pt1=a,this._pt2=b},c.Box2d.prototype.isEqualTo=function(a){return this._pt1.isEqualTo(a._pt1)?!!this._pt2.isEqualTo(a._pt2):!1},c.Box2d.prototype.containsPoint=function(a){return a.x()<this._pt1.x()||a.x()>this._pt2.x()?!1:!(a.y()<this._pt1.y()||a.y()>this._pt2.y())},c.Box2d.prototype.intersects=function(a){var b=a._pt1,d=a._pt2,e=c.vector2dFromElements(a._pt1.x(),a._pt2.y()),f=c.vector2dFromElements(a._pt2.x(),a._pt1.y());if(this.containsPoint(b))return!0;if(this.containsPoint(d))return!0;if(this.containsPoint(e))return!0;if(this.containsPoint(f))return!0;var g=this._pt1,h=this._pt2,i=c.vector2dFromElements(this._pt1.x(),this._pt2.y()),j=c.vector2dFromElements(this._pt2.x(),this._pt1.y());return a.containsPoint(g)?!0:a.containsPoint(h)?!0:a.containsPoint(i)?!0:!!a.containsPoint(j)},c.Box2d.prototype.toString=function(){return"p1="+this._pt1+", pt2="+this._pt2},c.Circle2d=function(a,b){this._v=a,this._r=b,this._r2=b*b},c.Circle2d.prototype.isEqualTo=function(a){return this._v.isEqualTo(a._v)?this._r===a._r:!1},c.Circle2d.prototype.getBoundingBox2d=function(){var a=this._v.x(),b=this._v.y();return new c.Box2d(new c.vector2dFromElements(a-this._r,b-this._r),new c.vector2dFromElements(a+this._r,b+this._r))},c.Circle2d.prototype.containsPoint=function(a){return this._v.sub(a).lengthSquared()<=this._r2},c.Circle2d.prototype.tangentFrom=function(a){var b=this._v.x(),d=this._v.y(),e=a.x(),f=a.y(),g=this._r,h=b-e,i=d-f,j=Math.sqrt(h*h+i*i),k=Math.asin(g/j),l=Math.atan2(i,h),m=l-k,n=l+k;return{p1:c.vector2dFromElements(g*Math.sin(m),g*-Math.cos(m)),p2:c.vector2dFromElements(g*-Math.sin(n),g*Math.cos(n)),center:c.vector2dFromElements(-g*Math.cos(l),g*-Math.sin(l)),arclength:2*k}},c.Circle2d.prototype.toString=function(){return"c="+this._v+", r="+this._r},c.Sphere=function(a,b){this._v=a,this._r=b,this._r2=b*b},c.Sphere.prototype.isEqualTo=function(a){return this._v.isEqualTo(a._v)?this._r===a._r:!1},c.Sphere.prototype.intersect=function(a){var b=this._v,c=this._r,d=a.getStart(),e=a.getDirection(),f=d.sub(b),g=e.dot(f),h=f.lengthSquared(),i=g*g-h+c*c;if(!(0>i)){var j;if(0===i)j=-g;else{var k=Math.sqrt(i),l=-g-k,m=-g+k;j=m>l?l:m}var n=a.getPointAtLength(j),o=n.sub(b).unit();return{object:this,normal:o,ray:a,pointOfIntersect:n,rayLengthOfIntersect:j}}},c.Sphere.prototype.getBoundingBox3d=function(){var a=this._v.x(),b=this._v.y(),d=this._v.z();return new c.Box3d(new c.vector3dFromElements(a-this._r,b-this._r,d-this._r),new c.vector3dFromElements(a+this._r,b+this._r,d+this._r))},c.Sphere.prototype.containsPoint=function(a){return this._v.sub(a).lengthSquared()<=this._r2},c.Sphere.prototype.tangentFrom=function(d){var e=this._v.x(),f=this._v.y(),g=d.x(),h=d.y(),i=this._r;return dx=e-g,dy=f-h,dd=Math.sqrt(dx*dx+dy*dy),a=Math.asin(i/dd),b=Math.atan2(dy,dx),t1=b-a,t2=b+a,{p1:c.vector3dFromElements(i*Math.sin(t1),i*-Math.cos(t1)),p2:c.vector3dFromElements(i*-Math.sin(t2),i*Math.cos(t2))}},c.Sphere.prototype.toString=function(){return"c="+this._v+", r="+this._r},c.Line3d=function(a,b){this._v=a,this._r=b,this._r2=b*b},c.Line3d.prototype.isEqualTo=function(a){return this._v.isEqualTo(a._v)?this._r===a._r:!1},c.Line3d.prototype.intersect=function(a){var b=this._v,c=this._r,d=a.getStart(),e=a.getDirection(),f=d.sub(b),g=e.dot(f),h=f.lengthSquared(),i=g*g-h+c*c;if(!(0>i)){var j;if(0===i)j=-g;else{var k=Math.sqrt(i),l=-g-k,m=-g+k;j=m>l?l:m}var n=a.getPointAtLength(j),o=n.sub(b).unit();return{object:this,normal:o,ray:a,pointOfIntersect:n,rayLengthOfIntersect:j}}},c.Line3d.prototype.getBoundingBox3d=function(){var a=this._v.x(),b=this._v.y(),d=this._v.z();return new c.Box3d(new c.vector3dFromElements(a-this._r,b-this._r,d-this._r),new c.vector3dFromElements(a+this._r,b+this._r,d+this._r))},c.Line3d.prototype.containsPoint=function(a){return this._v.sub(a).lengthSquared()<=this._r2},c.Line3d.prototype.tangentFrom=function(d){var e=this._v.x(),f=this._v.y(),g=d.x(),h=d.y(),i=this._r;return dx=e-g,dy=f-h,dd=Math.sqrt(dx*dx+dy*dy),a=Math.asin(i/dd),b=Math.atan2(dy,dx),t1=b-a,t2=b+a,{p1:c.vector3dFromElements(i*Math.sin(t1),i*-Math.cos(t1)),p2:c.vector3dFromElements(i*-Math.sin(t2),i*Math.cos(t2))}},c.Line3d.prototype.toString=function(){return"c="+this._v+", r="+this._r},c.Line2d=function(a,b){this._p1=a,this._p2=b},c.Line2d.prototype.isEqualTo=function(a){return this._p1.isEqualTo(a._p1)?!!this._p2.isEqualTo(a._p2):!1},c.Line2d.prototype.getDirection=function(){return this._p2.sub(this._p1)},c.Line2d.prototype.getAngleToXAxis=function(){var a=this.getDirection();return Math.atan2(a.y(),a.x())},c.Line2d.prototype.isPointOnLeftOfLine=function(a){var b=new c.Line2d(this._p1,a),d=new c.Line2d(this._p1,this._p2),e=g(b.getAngleToXAxis()),f=g(d.getAngleToXAxis());return g(e-f)>=0},c.Line2d.prototype.toString=function(){return"p1="+this._p1+", p2="+this._p2},c.Polygon2d=function(a){this._corners=a},c.Polygon2d.prototype.getCorners=function(){return this._corners},c.Polygon2d.prototype.isEqualTo=function(a){for(var b=0;b<this._corners.length;b++){var c=this._corners[b],d=a._corners[b];if(!c.isEqualTo(d))return!1}return!0},c.Polygon2d.prototype.containsPoint=function(a){for(var b=!1,c=this._corners.length,d=0,e=c-1;c>d;e=d++){var f=this._corners[d].x(),g=this._corners[d].y(),h=this._corners[e].x(),i=this._corners[e].y(),j=a.x(),k=a.y(),l=g>k,m=i>k,n=j,o=(h-f)*(k-g)/(i-g)+f;l!==m&&o>n&&(b=!b)}return b},c.Polygon2d.prototype.toString=function(){var a;return this._corners.forEach(function(b){a+=a?"; "+b:b}),a},c.createBoundingPolygon=function(a){if(0===a.length)return[];var b,d=function(){var b;return a.forEach(function(a){b?b.x()>a.x()&&(b=a):b=a}),b},e=function(a,b,d){var e=new c.Line2d(b,d);return e.isPointOnLeftOfLine(a)},f=[],g=d(),h=0;do{f[h]=g,b=void 0;for(var i=0;i<a.length;i++){var j=a[i];if(g!==j&&(void 0===b&&(b=j),b===g||e(j,g,b))){if(g.isEqualTo(j))return;b=j}}g=b,h+=1}while(!b.isEqualTo(f[0]));return f}}("undefined"==typeof exports?this.vecmat={}:exports);